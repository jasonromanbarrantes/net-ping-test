<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LLS – 15-Minute Connectivity Ping</title>
  <style>
    body{font-family:system-ui,Arial,Helvetica,sans-serif;max-width:900px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 8px}
    .muted{color:#6b7280}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:14px 0}
    code{background:#f6f8fa;padding:2px 6px;border-radius:4px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #d1d5db;text-decoration:none;cursor:pointer}
    select{padding:8px;border:1px solid #d1d5db;border-radius:8px;min-width:260px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .cmd{white-space:pre-wrap;background:#0e1111;color:#c8d1d9;padding:12px;border-radius:8px;font-family:ui-monospace,Menlo,Consolas,monospace}
    .note{font-size:14px;color:#4b5563}
    .success{color:#059669;margin-left:8px}
    .warn{color:#b45309}
  </style>
</head>
<body>
  <h1>LLS – 15-Minute Connectivity Ping</h1>
  <div class="muted">Client-to-Server network path verification</div>

  <div class="card">
    <h3>Purpose</h3>
    <p>
      This diagnostic verifies end-to-end connectivity and latency from the interpreter’s workstation and local network
      to the LanguageLine service infrastructure at the selected location. Results help LLS IT confirm whether performance
      issues originate on the client network path or beyond.
    </p>
  </div>

  <div class="card">
    <h3>1) Choose Location</h3>
    <div class="row">
      <label for="loc"><strong>Location</strong></label>
      <select id="loc"></select>
      <div id="ipview" class="note"></div>
    </div>
    <div class="note" style="margin-top:8px">
      Each location maps to the <em>first</em> IP for that site.
    </div>
  </div>

  <div class="card">
    <h3>2) Copy the 15-Minute Ping Command</h3>
    <p class="note">This runs locally on the interpreter’s machine (their network). No files are downloaded.</p>
    <div class="row" style="margin:8px 0">
      <button class="btn" id="copyBtn">Copy Command</button>
      <span id="copied" class="success" style="display:none">Copied</span>
    </div>
    <div class="cmd" id="cmdPreview"></div>
  </div>

  <div class="card">
    <h3>3) Run in PowerShell (Admin)</h3>
    <ol>
      <li>Right-click Start → <strong>Windows PowerShell</strong> (or Terminal) → <strong>Run as Administrator</strong>.</li>
      <li>Allow scripts for this session only:<br>
        <code>Set-ExecutionPolicy -Scope Process Bypass -Force</code>
      </li>
      <li>Paste the command you copied and press <strong>Enter</strong>.</li>
    </ol>
    <p class="note">
      When finished (~15 minutes), artifacts are saved to <code>%TEMP%\pingtest_&lt;timestamp&gt;</code>:
      <code>ping_&lt;ip&gt;_raw.txt</code>, <code>summary.json</code>, and <code>results.zip</code>.
    </p>
    <p class="warn"><strong>Why can’t the page run the test by itself?</strong> Browsers are sandboxed for security and cannot run ICMP ping
      or open a real CMD/PowerShell window. This copy-and-paste step is the safe, standard approach.</p>
  </div>

  <script>
    // First IP per site (as requested)
    const locations = [
      { name: "LAX", ip: "216.20.237.2" },
      { name: "DAL", ip: "216.20.235.2" },
      { name: "FRA", ip: "154.60.103.161" },
      { name: "MUN", ip: "154.48.222.161" },
      { name: "Melbourne", ip: "216.20.247.161" },
      { name: "Sydney", ip: "207.166.102.129" },
      { name: "Tokyo", ip: "210.57.75.129" },
      { name: "Sao Paulo", ip: "200.15.3.129" },
      { name: "SGP", ip: "61.14.30.129" },
      { name: "London", ip: "213.198.48.129" },
      { name: "Manchester", ip: "213.198.49.129" },
      { name: "Toronto", ip: "38.64.141.129" },
      { name: "Montreal", ip: "38.80.80.129" },
      { name: "Abu Dhabi", ip: "83.111.4.161" },
      { name: "Dubai", ip: "83.111.3.129" },
      { name: "Mumbai", ip: "216.20.250.129" },
      { name: "Hyderabad", ip: "216.20.251.129" },
      // (LAX/Linc and DAL/Linc second IPs omitted by request; using first IP per site)
      // (Extra SGP entries omitted; using first IP 61.14.30.129)
    ];

    const locSel = document.getElementById("loc");
    const ipview = document.getElementById("ipview");
    const cmdPreview = document.getElementById("cmdPreview");
    const copyBtn = document.getElementById("copyBtn");
    const copied = document.getElementById("copied");

    locations.forEach((l, i) => {
      const opt = document.createElement("option");
      opt.value = l.ip;
      opt.textContent = `${l.name} — ${l.ip}`;
      if (i === 0) opt.selected = true;
      locSel.appendChild(opt);
    });

    function buildCommand(ip){
      // 15 minutes ≈ 900 echoes at 1 pkt/sec (-n 900)
      // Saves raw output + summary.json + results.zip in %TEMP%\pingtest_<timestamp>
      return [
        'Set-ExecutionPolicy -Scope Process Bypass -Force;',
        '$ip="'+ip+'";',
        '$ts=Get-Date -Format "yyyyMMdd_HHmmss";',
        '$wd=Join-Path $env:TEMP ("pingtest_"+$ts);',
        'New-Item -ItemType Directory -Path $wd -Force | Out-Null;',
        '$rawPath=Join-Path $wd ("ping_"+$ip+"_raw.txt");',
        'ping.exe -n 900 $ip | Tee-Object -FilePath $rawPath;',
        '$raw=Get-Content $rawPath -Raw;',
        '$lm=[regex]"Packets: Sent = (\\d+), Received = (\\d+), Lost = (\\d+) \\((\\d+)% loss\\)".Match($raw);',
        '$rm=[regex]"Minimum = (\\d+)ms, Maximum = (\\d+)ms, Average = (\\d+)ms".Match($raw);',
        '$obj=[ordered]@{ip=$ip;sent=$lm.Groups[1].Value;received=$lm.Groups[2].Value;lost=$lm.Groups[3].Value;lossPct=$lm.Groups[4].Value;minMs=$rm.Groups[1].Value;maxMs=$rm.Groups[2].Value;avgMs=$rm.Groups[3].Value};',
        '$obj | ConvertTo-Json | Set-Content (Join-Path $wd "summary.json");',
        'Compress-Archive -Path "$wd\\*" -DestinationPath (Join-Path $wd "results.zip") -Force;',
        'Write-Host ("Done. Outputs in: "+$wd) -ForegroundColor Green;'
      ].join(' ');
    }

    function refresh(){
      const ip = locSel.value;
      ipview.textContent = "Selected IP: "+ip;
      cmdPreview.textContent = buildCommand(ip);
      copied.style.display = "none";
    }

    locSel.addEventListener("change", refresh);
    refresh();

    copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(cmdPreview.textContent);
        copied.style.display = "inline";
        setTimeout(()=> copied.style.display="none", 2200);
      } catch(e){
        alert("Copy failed. Manually select and copy the command.");
      }
    });
  </script>
</body>
</html>
